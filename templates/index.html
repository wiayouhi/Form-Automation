<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Google Form Web Pro - Enhanced UI</title>
    <link rel="icon" href="image_36d6ae.jpg" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Dark mode base with a subtle gradient background */
        body {
            background: #111827; /* Dark Slate */
            background: radial-gradient(circle at 10% 20%, #1e293b 0%, #0f172a 100%);
            min-height: 100vh;
        }
        /* Custom Scrollbar for better aesthetics */
        #log-container::-webkit-scrollbar, #history-list::-webkit-scrollbar { width: 6px; }
        #log-container::-webkit-scrollbar-thumb, #history-list::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 3px; }
        
        /* Custom Focus/Shadow effects for inputs */
        input:focus, select:focus {
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.5); /* Indigo glow */
        }

        /* Keyframe for simple loading animation */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin 3s linear infinite;
        }

        /* Style for the ping indicator */
        .ping-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .ping-green { background-color: #10b981; }
        .ping-yellow { background-color: #f59e0b; }
        .ping-red { background-color: #ef4444; }

        /* --- SHINE LOOP KEYFRAME --- */
        @keyframes shine-loop {
            0% { transform: translateX(-100%) skewX(-20deg); }
            100% { transform: translateX(300%) skewX(-20deg); }
        }
        /* --- SHINE EFFECT STYLES --- */
        .shine-effect {
            position: relative;
            overflow: hidden; 
            z-index: 1; 
            border-radius: 12px; 
            transition: box-shadow 0.3s ease, transform 0.1s; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4); 
        }

        .shine-effect::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 30%; 
            height: 100%;
            background: rgba(255, 255, 255, 0.3); 
            z-index: 2; 
            /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡∏ä‡πâ‡∏≤‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) */
            animation: shine-loop 1.5s linear infinite; 
        }

        /* ‡∏Ñ‡∏•‡∏≤‡∏™‡πÉ‡∏´‡∏°‡πà: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Turbo Shine (‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏£‡πá‡∏ß 0.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ) */
        .shine-turbo::before {
            animation-duration: 0.5s !important; 
        }
        /* --- END SHINE EFFECT STYLES --- */

        /* --- BACKGROUND EMOJI ANIMATION --- */
        @keyframes float-up {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            50% { opacity: 0.8; }
            100% { transform: translateY(-50vh) rotate(360deg); opacity: 0; }
        }
        
        .emoji-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -10; 
            pointer-events: none; 
        }

        .emoji-item {
            position: absolute;
            bottom: 0;
            font-size: 30px; 
            color: rgba(255, 255, 255, 0.1); 
            animation-name: float-up;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
        }

        /* --- SPEED MODIFIERS (‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß) --- */
        .speed-default .emoji-item {
            animation-duration: 25s; 
        }
        .speed-turbo .emoji-item {
            animation-duration: 6s; 
        }
        /* --- END BACKGROUND EMOJI ANIMATION --- */

        /* --- DISCORD STATUS STYLES --- */
        .avatar-container {
            position: relative;
            width: 60px;
            height: 60px;
            flex-shrink: 0;
        }
        .avatar-img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid transparent; 
        }
        .status-dot {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            border: 4px solid #1f2937; 
        }
        .status-online { background-color: #3ba55d; } 
        .status-idle { background-color: #faa81a; }    
        .status-dnd { background-color: #ed4245; }     
        .status-offline { background-color: #747f8d; } 
        
        .activity-img-container {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
            margin-right: 10px;
            border: 1px solid #374151;
            background-color: #0f172a;
        }
        .activity-img-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        /* --- END DISCORD STATUS STYLES --- */

        /* --- INTRO ANIMATION STYLES --- */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0f172a; /* Same as background end color */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            transition: opacity 1s ease-out, visibility 1s ease-out;
        }

        @keyframes cube-flip {
            0%, 100% {
                transform: rotateY(0deg) rotateX(0deg);
                opacity: 1;
            }
            25% {
                transform: rotateY(90deg) rotateX(0deg);
                opacity: 0.8;
            }
            50% {
                transform: rotateY(90deg) rotateX(90deg);
                opacity: 0.5;
            }
            75% {
                transform: rotateY(0deg) rotateX(90deg);
                opacity: 0.8;
            }
        }

        .cube-loader {
            width: 80px;
            height: 80px;
            perspective: 150px;
        }
        
        .cube-inner {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            animation: cube-flip 2.5s infinite ease-in-out;
        }

        .cube-face {
            position: absolute;
            width: 80px;
            height: 80px;
            background: rgba(99, 102, 241, 0.8); /* Indigo */
            border: 2px solid #6366f1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            font-weight: bold;
            color: white;
            opacity: 0.9;
        }

        .cube-face:nth-child(1) { transform: rotateY(0deg) translateZ(40px); background: #4f46e5; }
        .cube-face:nth-child(2) { transform: rotateY(180deg) translateZ(40px); background: #4338ca; }
        .cube-face:nth-child(3) { transform: rotateX(90deg) translateZ(40px); background: #3730a3; }
        .cube-face:nth-child(4) { transform: rotateX(-90deg) translateZ(40px); background: #4f46e5; }
        /* --- END INTRO ANIMATION STYLES --- */
        
        /* --- MODAL ANIMATION STYLES (NEW) --- */
        .modal-enter {
            opacity: 0;
            transform: scale(0.9);
        }
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 300ms ease-out, transform 300ms ease-out;
        }
        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 300ms ease-in, transform 300ms ease-in;
        }
        /* --- END MODAL ANIMATION STYLES --- */
    </style>
</head>
<body class="text-slate-100 p-4 sm:p-8">

    <div id="splash-screen">
        <div class="cube-loader">
            <div class="cube-inner">
                <div class="cube-face">F</div>
                <div class="cube-face">O</div>
                <div class="cube-face">R</div>
                <div class="cube-face">M</div>
            </div>
        </div>
        <p class="mt-8 text-2xl font-semibold text-indigo-400">LOADING AUTOMATION PRO</p>
        <p class="text-slate-400 mt-2 text-sm">Initializing hyper-drive cores...</p>
    </div>
    <div id="main-content" class="max-w-6xl mx-auto opacity-0 transition-opacity duration-1000">
        <div id="emoji-bg-container" class="emoji-background speed-default">
            </div>
        <header class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-indigo-400">
                <span class="animate-spin-slow inline-block text-3xl">‚öôÔ∏è</span>
                Form Automation Pro
            </h1>
            <p class="text-slate-400 mt-2">Powerful, Multi-threaded Google Form Submission Tool</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            
            <div class="lg:col-span-1 bg-slate-800 p-6 rounded-2xl shadow-2xl border border-slate-700 h-fit space-y-4">
                <h3 class="text-xl font-bold text-yellow-400 border-b border-slate-700 pb-2">üìä Real-time Status</h3>

                <div class="p-3 bg-slate-700 rounded-lg shadow-inner">
                    <p class="text-sm font-medium text-slate-300 flex items-center mb-1">
                        <span id="ping-dot" class="ping-dot ping-yellow"></span>
                        Server Status / Ping: <span id="ping-status" class="ml-1 text-yellow-300">Checking...</span>
                    </p>
                    <p class="text-xs text-slate-400">Latency to Flask Server.</p>
                </div>
                
                <div class="p-4 bg-slate-700 rounded-xl shadow-lg border border-slate-600">
                    <h4 class="text-sm font-bold text-green-400 mb-3 border-b border-slate-600 pb-2">üìà Submission Summary</h4>
                    <div class="grid grid-cols-3 gap-2 text-center">
                        <div>
                            <p id="global-attempt-counter" class="text-2xl font-extrabold text-indigo-400">0</p>
                            <p class="text-xs text-slate-400">Attempts</p>
                        </div>
                        <div>
                            <p id="global-success-counter" class="text-2xl font-extrabold text-green-400">0</p>
                            <p class="text-xs text-slate-400">Success</p>
                        </div>
                        <div>
                            <p id="global-error-counter" class="text-2xl font-extrabold text-red-400">0</p>
                            <p class="text-xs text-slate-400">Errors</p>
                        </div>
                    </div>
                    <p id="global-completion-message" class="text-center mt-3 text-xs font-semibold text-slate-300 hidden">Session summary will appear here.</p>
                </div>
                
                <div class="p-4 bg-slate-700 rounded-xl shadow-lg border border-slate-600">
                    <h4 class="text-sm font-bold text-indigo-400 mb-3 border-b border-slate-600 pb-2 flex items-center">
                        <span class="text-xl mr-2">üí°</span> Guide & Tips
                    </h4>
                    
                    <div class="mb-2">
                        <button onclick="toggleGuide('guide-link')" class="w-full text-left flex justify-between items-center text-sm font-semibold text-slate-200 hover:text-indigo-300 transition-colors">
                            <span>1. ‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö Prefill ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?</span>
                            <span id="toggle-icon-guide-link" class="transform transition-transform duration-300">‚ñº</span>
                        </button>
                        <div id="guide-link" class="hidden text-xs text-slate-400 pt-2 pl-3 border-l border-indigo-400 mt-1 space-y-1">
                            <p>‡πÉ‡∏ä‡πâ‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡πÅ‡∏ö‡∏ö **Prefill Link** ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô (‡∏ó‡∏µ‡πà‡∏°‡∏µ `viewform?usp=pp_url...`) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á `entry.ID` ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏°‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                            <p class="text-yellow-300 font-mono bg-slate-800 p-1 rounded">‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤: ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ > ‡∏Å‡∏î "‡∏£‡∏±‡∏ö‡∏•‡∏¥‡πâ‡∏á‡∏Ñ‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤"</p>
                        </div>
                    </div>

                    <div class="mb-2">
                        <button onclick="toggleGuide('guide-id')" class="w-full text-left flex justify-between items-center text-sm font-semibold text-slate-200 hover:text-indigo-300 transition-colors">
                            <span>2. ‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤ Entry ID ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</span>
                            <span id="toggle-icon-guide-id" class="transform transition-transform duration-300">‚ñº</span>
                        </button>
                        <div id="guide-id" class="hidden text-xs text-slate-400 pt-2 pl-3 border-l border-indigo-400 mt-1 space-y-1">
                            <p>‡∏´‡∏≤‡∏Å Fetch ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏Å‡∏î F12 (Inspect) ‡∏ö‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏≤ Tag Input/Textarea ‡∏ó‡∏µ‡πà‡∏°‡∏µ attribute `name="entry.123456789"` ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠ Entry ID</p>
                            <p class="text-red-300 font-mono bg-slate-800 p-1 rounded">‚ö†Ô∏è ‡∏´‡∏≤‡∏Å ID ‡∏ú‡∏¥‡∏î ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</p>
                        </div>
                    </div>

                    <div>
                        <button onclick="toggleGuide('guide-mode')" class="w-full text-left flex justify-between items-center text-sm font-semibold text-slate-200 hover:text-indigo-300 transition-colors">
                            <span>3. ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Answer Mode</span>
                            <span id="toggle-icon-guide-mode" class="transform transition-transform duration-300">‚ñº</span>
                        </button>
                        <div id="guide-mode" class="hidden text-xs text-slate-400 pt-2 pl-3 border-l border-indigo-400 mt-1 space-y-1">
                            <p>**Random (‡∏™‡∏∏‡πà‡∏°):** ‡∏à‡∏∞‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á Value (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≠‡∏°‡∏°‡πà‡∏≤).</p>
                            <p>**Sequential (‡πÄ‡∏£‡∏µ‡∏¢‡∏á):** ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏°‡∏ã‡πâ‡∏≥‡πÜ).</p>
                        </div>
                    </div>
                </div>
                <div class="p-4 bg-slate-700 rounded-xl shadow-lg border border-slate-600">
                    <h4 class="text-sm font-bold text-indigo-400 mb-3 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12.012 0C7.234 0 3.322 3.864 3.322 8.648c0 2.23 0.865 4.316 2.45 5.867 0.17 0.17 0.38 0.283 0.602 0.316 0.21.034 0.428 0.006 0.627 -0.076 0.198 -0.082 0.364 -0.218 0.49 -0.385l0.424 -0.565c0.166 -0.22 0.217 -0.496 0.147 -0.742 -0.237 -0.806 -0.362 -1.65 -0.362 -2.54 0 -4.843 3.912 -8.76 8.76 -8.76s8.76 3.917 8.76 8.76c0 0.89 -0.125 1.734 -0.362 2.54 -0.07 0.246 -0.019 0.522 0.147 0.742l0.424 0.565c0.126 0.167 0.292 0.303 0.49 0.385 0.199 0.082 0.417 0.11 0.627 0.076 0.222 -0.033 0.432 -0.146 0.602 -0.316 1.585 -1.551 2.45 -3.637 2.45 -5.867 0 -4.784 -3.912 -8.648 -8.696 -8.648h-0.012zM12.012 18.358c-1.397 0 -2.697 -0.626 -3.585 -1.716l-0.195 -0.236c-0.122 -0.148 -0.334 -0.218 -0.523 -0.187 -0.245 0.04 -0.473 0.13 -0.662 0.264l-2.007 1.488c-0.217 0.16 -0.49 0.203 -0.738 0.108 -0.247 -0.095 -0.44 -0.315 -0.518 -0.589 -0.08 -0.273 -0.007 -0.575 0.197 -0.78l1.378 -1.407c0.165 -0.168 0.25 -0.407 0.25 -0.655v-0.565c0 -0.478 0.162 -0.938 0.457 -1.31l0.395 -0.514c0.238 -0.308 0.373 -0.687 0.373 -1.085v-1.286c0 -0.335 -0.272 -0.607 -0.607 -0.607s-0.607 0.272 -0.607 0.607v1.286c0 0.57 -0.19 1.107 -0.536 1.513l-0.395 0.514c-0.51 0.665 -0.796 1.458 -0.796 2.293v0.565c0 0.648 -0.25 1.26 -0.697 1.708l-1.378 1.407c-0.204 0.205 -0.277 0.507 -0.197 0.78 0.078 0.274 0.271 0.494 0.518 0.589 0.248 0.095 0.52 0.052 0.738 -0.108l2.007 -1.488c0.189 -0.134 0.417 -0.224 0.662 -0.264 0.189 -0.031 0.401 0.039 0.523 0.187l0.195 0.236c0.888 1.09 2.188 1.716 3.585 1.716s2.697 -0.626 3.585 -1.716l0.195 -0.236c-0.122 -0.148 -0.334 -0.218 -0.523 -0.187 -0.245 0.04 -0.473 0.13 -0.662 0.264l2.007 1.488c0.217 0.16 0.49 0.203 0.738 0.108 0.247 -0.095 0.44 -0.315 0.518 -0.589 0.08 -0.273 0.007 -0.575 -0.197 -0.78l-1.378 -1.407c-0.165 -0.168 -0.25 -0.407 -0.25 -0.655v-0.565c0 -0.478 -0.162 -0.938 -0.457 -1.31l0.395 -0.514c-0.238 -0.308 -0.373 -0.687 -0.373 -1.085v-1.286c0 -0.335 -0.272 -0.607 -0.607 -0.607s-0.607 0.272 -0.607 0.607v1.286c0 0.57 0.19 1.107 0.536 1.513l0.395 0.514c0.51 0.665 0.796 1.458 0.796 2.293v0.565c0 0.648 0.25 1.26 0.697 1.708l1.378 1.407c0.204 0.205 0.277 0.507 0.197 0.78 -0.078 0.274 -0.271 0.494 -0.518 0.589 -0.248 0.095 -0.52 0.052 -0.738 -0.108l-2.007 -1.488c-0.189 -0.134 -0.417 -0.224 -0.662 -0.264 -0.189 -0.031 -0.401 0.039 -0.523 0.187l-0.195 0.236c-0.888 1.09 -2.188 1.716 -3.585 1.716z"></path>
                        </svg>
                        Discord Lanyard Status
                    </h4>
                    
                    <div class="flex items-center space-x-4">
                        <div class="avatar-container">
                            <img id="discord-avatar" src="https://cdn.discordapp.com/embed/avatars/0.png" alt="Avatar" class="avatar-img">
                            <span id="discord-status-dot" class="status-dot status-offline"></span>
                        </div>
                        
                        <div class="flex-grow">
                            <p id="discord-username" class="text-lg font-bold text-slate-100">Loading...</p>
                            <p id="discord-main-status" class="text-sm text-slate-300">Status: <span id="discord-state-text" class="text-yellow-400">Connecting...</span></p>
                        </div>
                    </div>

                    <div id="discord-activity" class="mt-3 pt-3 border-t border-slate-600 hidden">
                        <p class="text-xs font-semibold text-slate-400 mb-2">Activity:</p>
                        <div class="flex items-center">
                            <div class="activity-img-container">
                                <img id="activity-large-image" src="" alt="Activity Image" class="hidden">
                            </div>
                            <div class="flex-1 min-w-0">
                                <p id="discord-activity-name" class="text-sm text-green-300 truncate font-mono"></p>
                                <p id="discord-activity-details" class="text-xs text-slate-400 truncate"></p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="lg:col-span-2 bg-slate-800 p-6 rounded-2xl shadow-2xl border border-slate-700">
                <h3 class="text-xl font-extrabold mb-4 text-blue-400 border-b border-slate-700 pb-2">‚öôÔ∏è Configuration</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Form URL (Prefill / View)</label>
                        <div class="flex gap-2">
                            <input id="url" type="text" class="flex-1 bg-slate-700 p-3 rounded-xl border border-slate-600 outline-none transition-all duration-300 focus:ring-2 focus:ring-indigo-500 text-sm" placeholder="https://docs.google.com/forms/...">
                            <button onclick="fetchEntries()" class="bg-indigo-600 hover:bg-indigo-500 px-4 py-1 rounded-xl text-sm font-bold transition-transform hover:scale-105 shine-effect">Fetch Entry</button>
                        </div>
                    </div>

                    <button onclick="addManualEntry()" class="w-full bg-slate-700 hover:bg-slate-600 py-2 rounded-xl text-sm font-medium text-purple-300 transition-colors border border-slate-600 shadow-md hover:shadow-lg shine-effect">
                        + Add Manual Entry Field
                    </button>

                    <div id="entry-list" class="space-y-2 max-h-48 overflow-y-auto p-3 bg-slate-900 rounded-xl border border-slate-700">
                        <p class="text-slate-500 text-xs text-center">> Entry data will appear here after fetching.</p>
                    </div>

                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div>
                            <label class="text-xs font-bold text-slate-300">Total Submissions</label>
                            <input id="total" type="number" value="50" min="1" class="w-full bg-slate-700 p-3 rounded-xl border border-slate-600 transition-shadow">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-300">Bots / Threads</label>
                            <input id="bots" type="number" value="10" min="1" class="w-full bg-slate-700 p-3 rounded-xl border border-slate-600 transition-shadow">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-orange-300">Number of Sections (‡∏´‡∏ô‡πâ‡∏≤)</label>
                            <input id="pages" type="number" value="1" min="1" class="w-full bg-slate-700 p-3 rounded-xl border border-slate-600 transition-shadow">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-300">Delay per Bot (s)</label>
                            <input id="delay" type="number" value="0.5" step="0.1" class="w-full bg-slate-700 p-3 rounded-xl border border-slate-600 transition-shadow">
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-300">Answer Mode</label>
                            <select id="mode" class="w-full bg-slate-700 p-3 rounded-xl border border-slate-600 transition-shadow">
                                <option value="R">Random (‡∏™‡∏∏‡πà‡∏°)</option>
                                <option value="S">Sequential (‡πÄ‡∏£‡∏µ‡∏¢‡∏á)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex gap-4 mt-6"> 
                        <button onclick="startProcess()" id="start-btn" class="w-full bg-green-600 hover:bg-green-500 py-4 rounded-xl font-extrabold text-lg transition-all duration-300 ease-in-out shadow-lg shadow-green-900/40 hover:scale-[1.02] shine-effect">
                            üöÄ START AUTOMATION
                        </button>
                        <button onclick="stopProcess(false)" id="stop-btn" class="w-0 opacity-0 scale-0 bg-red-600 hover:bg-red-500 py-4 rounded-xl font-extrabold text-lg transition-all duration-300 ease-in-out origin-right shadow-lg shadow-red-900/40" disabled>
                            üõë ‡∏´‡∏¢‡∏∏‡∏î
                        </button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-3 bg-slate-800 p-6 rounded-2xl shadow-2xl border border-slate-700 flex flex-col">
                <h3 class="text-xl font-extrabold mb-4 text-purple-400 border-b border-slate-700 pb-2">üíª Live Activity Logs (Max 100 Lines)</h3>
                <div id="log-container" class="flex-1 bg-black rounded-xl p-4 font-mono text-xs overflow-y-auto h-[400px] border border-slate-700">
                    <div class="text-slate-500">> Ready. Paste URL and click Fetch.</div>
                </div>
                <button onclick="clearLog()" class="mt-4 text-xs text-slate-400 hover:text-white underline self-start transition-colors hover:scale-[1.05]">Clear Logs</button>
            </div>

        </div>
    </div>
    
    <footer class="max-w-6xl mx-auto mt-10 p-4 text-center text-slate-500 text-sm">
        <button onclick="showHistoryModal()" class="text-blue-400 hover:text-blue-300 underline mb-4 transition-colors">
            ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
        </button>
        <div class="flex justify-center space-x-6 mb-4">
            <a href="YOUR_GITHUB_URL" target="_blank" class="text-slate-400 hover:text-indigo-400 transition-colors transform hover:scale-110" aria-label="GitHub">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.082-.742.086-.725.086-.725 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.304.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.302-.536-1.521.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.046.138 3.003.404 2.293-1.552 3.301-1.23 3.301-1.23.653 1.655.241 2.874.118 3.176.766.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.474 5.923.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.309 24 12 24 5.373 18.627 0 12 0z"/></svg>
            </a>
            <a href="YOUR_INSTAGRAM_URL" target="_blank" class="text-slate-400 hover:text-pink-500 transition-colors transform hover:scale-110" aria-label="Instagram">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2.163c3.204 0 3.584.012 4.85.074 1.266.064 1.84.225 2.222.375.4.153.774.375 1.06.66l.51.51c.285.286.507.66.66 1.059.15.382.31 1.056.375 2.222.063 1.266.074 1.646.074 4.85s-.012 3.584-.074 4.85c-.064 1.266-.225 1.84-.375 2.222-.153.4-.375.774-.66 1.06l-.51.51c-.286.285-.66.507-1.059.66-.382.15-1.056.31-2.222.375-1.266.063-1.646.074-4.85.074s-3.584-.012-4.85-.074c-1.266-.064-1.84-.225-2.222-.375-.4-.153-.774-.375-1.06-.66l-.51-.51c-.285-.286-.507-.66-.66-1.059-.15-.382-.31-1.056-.375-2.222-.063-1.266-.074-1.646-.074-4.85s.012-3.584.074-4.85c.064-1.266.225-1.84.375-2.222.153-.4.375-.774.66-1.06l.51-.51c.286-.285.66-.507 1.059-.66.382-.15 1.056-.31 2.222-.375 1.266-.063 1.646-.074 4.85-.074z"/><path d="M12 6.865c-2.857 0-5.174 2.316-5.174 5.174s2.317 5.174 5.174 5.174 5.174-2.316 5.174-5.174-2.317-5.174-5.174-5.174zm0 8.528c-1.854 0-3.354-1.5-3.354-3.354s1.5-3.354 3.354-3.354 3.354 1.5 3.354 3.354-1.5 3.354-3.354 3.354z"/><circle cx="17.206" cy="6.93" r="1.266"/></svg>
            </a>
            <a href="YOUR_WEBSITE_URL" target="_blank" class="text-slate-400 hover:text-blue-400 transition-colors transform hover:scale-110" aria-label="Website/Portfolio">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm7.641 15.657l-1.318-1.318c.328-.27.652-.562.973-.865.253-.243.507-.487.756-.733.64-.633 1.258-1.3.931-2.222-.206-.593-.761-.926-1.551-.926h-1.077c-.503 0-1.002-.132-1.442-.387-.433-.251-.818-.62-1.144-1.075-.152-.213-.301-.428-.448-.642-.234-.338-.475-.672-.72-.998-.67-.9-.942-1.921-.692-2.903.322-1.272 1.602-2.222 2.91-2.222 1.056 0 2.046.36 2.836 1.026.58.49.923 1.153 1.066 1.895.079.396.115.795.109 1.192-.01.444-.24.86-.677 1.199l-1.037.81c-.22.172-.375.434-.447.724-.072.29.072.589.378.72l.405.176c.451.196.864.445 1.238.76.71.597 1.185 1.344 1.326 2.197.108.665-.011 1.32-.32 1.905-.386.741-1.011 1.29-1.84 1.498zM12 21.838c-5.42 0-9.838-4.418-9.838-9.838s4.418-9.838 9.838-9.838 9.838 4.418 9.838 9.838-4.418 9.838-9.838 9.838z"/></svg>
            </a>
        </div>
        <p>Built with ‚ù§Ô∏è by AI and Developers.</p>
        <p class="mt-1 text-xs text-slate-600">Form Automation Pro V1.0</p>
    </footer>
    
    <div id="cookie-banner" class="fixed bottom-0 left-0 right-0 bg-slate-900/95 backdrop-blur-sm p-4 text-center transform translate-y-full transition-transform duration-500 ease-out z-50 shadow-[0_0_20px_rgba(0,0,0,0.8)] border-t border-indigo-700">
        <div class="max-w-4xl mx-auto flex flex-col md:flex-row items-center justify-between">
            <p class="text-sm text-slate-200 mb-3 md:mb-0 mr-4">
                üç™ ‡πÄ‡∏£‡∏≤‡πÉ‡∏ä‡πâ‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤
            </p>
            <div class="flex space-x-3">
                <button onclick="setCookieConsent('accept')" class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors">
                    ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
                <button onclick="setCookieConsent('reject')" class="bg-slate-700 hover:bg-slate-600 text-slate-300 px-4 py-2 rounded-lg text-sm font-semibold transition-colors">
                    ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
                </button>
            </div>
        </div>
    </div>

    <div id="history-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm hidden items-center justify-center z-50 transition-opacity duration-300">
        <div id="history-modal-content" class="bg-slate-800 p-6 rounded-2xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col border border-slate-700 modal-enter">
            <h3 class="text-2xl font-bold text-blue-400 mb-4 border-b border-slate-700 pb-2 flex items-center">
                <span class="text-3xl mr-2">üìú</span> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            </h3>
            <div id="history-list" class="flex-1 overflow-y-auto space-y-3 p-2 bg-slate-900 rounded-lg border border-slate-700">
                <p class="text-slate-500 text-sm text-center">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
            </div>
            <div class="flex justify-between items-center mt-4 pt-2 border-t border-slate-700">
                 <button onclick="clearHistory()" class="text-red-400 hover:text-red-300 text-sm transition-colors font-semibold flex items-center">
                    <span class="mr-1">üóëÔ∏è</span> ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                </button>
                <button onclick="hideHistoryModal()" class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors">
                    ‡∏õ‡∏¥‡∏î
                </button>
            </div>
        </div>
    </div>
    <script src="https://kit.fontawesome.com/your-font-awesome-kit.js" crossorigin="anonymous"></script> 

    <script>
        // ---------------------------------------------------
        // Global State & UI/UX Helpers
        // ---------------------------------------------------
        let totalSuccessCounter = 0; 
        let totalErrorsCounter = 0; 
        let totalAttemptsCounter = 0; 
        let eventSource = null; // NEW: Global for EventSource
        let consentStatus = localStorage.getItem('cookieConsent'); // NEW: Global for Consent
        const HISTORY_KEY = 'formAutomationHistory'; // NEW: History Key

        function createEntryField(id = '', value = '', isManual = false) {
            const uniqueId = Math.random().toString(36).substring(2, 9);
            
            return `
                <div id="entry-${uniqueId}" class="flex flex-col mb-2 p-3 bg-slate-700 rounded-lg shadow-md border border-slate-600 transition-all duration-200">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-[10px] text-blue-400 font-bold">${isManual ? 'MANUAL ID' : id}</span>
                        ${isManual ? `<button onclick="removeEntry('${uniqueId}')" class="text-red-400 text-sm hover:text-red-300 font-bold leading-none transition-colors">x</button>` : ''}
                    </div>
                    <input type="text" 
                           class="entry-id-input bg-transparent text-sm outline-none focus:border-b border-blue-400 py-1 mb-1 transition-all ${isManual ? '' : 'text-slate-400'}"
                           value="${id}"
                           placeholder="${isManual ? 'entry.123456789' : ''}"
                           ${isManual ? '' : 'readonly'}>
                    <input type="text" 
                           data-id="${id}" 
                           data-manual="${isManual}"
                           value="${value}" 
                           class="entry-value-input bg-transparent text-sm outline-none focus:border-b border-blue-400 py-1 transition-all"
                           placeholder="Answers separated by comma (e.g., Ans1,Ans2,Ans3)">
                    <p class="text-[10px] text-slate-400 mt-1">Answers separated by comma (e.g., Ans1,Ans2,Ans3)</p>
                </div>
            `;
        }

        function addManualEntry() {
            const container = document.getElementById('entry-list');
            if (container.querySelector('.text-slate-500')) {
                container.innerHTML = '';
            }
            container.innerHTML += createEntryField('', '', true);
            container.lastElementChild.querySelector('.entry-id-input').focus(); 
        }

        function removeEntry(uniqueId) {
            const element = document.getElementById(`entry-${uniqueId}`);
            if (element) {
                element.remove();
                const container = document.getElementById('entry-list');
                if (container.children.length === 0) {
                     container.innerHTML = "<p class='text-slate-500 text-xs text-center'>Entry data will appear here after fetching.</p>";
                }
            }
        }
        
        // **NEW GUIDE TOGGLE FUNCTION**
        function toggleGuide(id) {
            const content = document.getElementById(id);
            const icon = document.getElementById(`toggle-icon-${id}`);
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }


        // ---------------------------------------------------
        // 1. Fetch Entries (Unchanged)
        // ---------------------------------------------------
        async function fetchEntries() {
            const url = document.getElementById('url').value;
            const container = document.getElementById('entry-list');
            container.innerHTML = `<p class='text-yellow-400 text-xs text-center flex items-center justify-center'><svg class="animate-spin -ml-1 mr-3 h-4 w-4 text-yellow-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d='M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z'></path></svg>Fetching...</p>`;

            try {
                // NOTE: This call will likely fail in a browser environment without a backend.
                // Assuming /api/parse-url is a valid endpoint.
                const res = await fetch('/api/parse-url', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({url})
                });
                const data = await res.json();
                container.innerHTML = "";

                if (Object.keys(data.entries).length === 0) {
                    container.innerHTML = "<p class='text-red-400 text-xs text-center'>‚ùå No entry found. Ensure the URL is a prefill link.</p>";
                    return;
                }

                for (const [id, val] of Object.entries(data.entries)) {
                    container.innerHTML += createEntryField(id, val, false);
                }
            } catch (error) {
                // Fallback for demo/missing backend:
                if (url.includes('example.com')) {
                    container.innerHTML = "";
                    container.innerHTML += createEntryField('entry.123456789', 'ValueA,ValueB', false);
                    container.innerHTML += createEntryField('entry.987654321', 'Random Text Answer', false);
                    logContainer.innerHTML += "<div class='text-orange-400'>[WARNING] Using mock data for Fetch.</div>";
                    return;
                }
                container.innerHTML = "<p class='text-red-400 text-xs text-center'>‚ö†Ô∏è Connection or URL error.</p>";
            }
        }

        // ---------------------------------------------------
        // UI Control Functions (Unchanged)
        // ---------------------------------------------------
        function setBackgroundSpeed(speedClass) {
            const container = document.getElementById('emoji-bg-container');
            container.classList.remove('speed-default', 'speed-turbo');
            container.classList.add(speedClass);
        }
        
        function setShineSpeed(isTurbo) {
            const startBtn = document.getElementById('start-btn');
            const fetchBtn = document.querySelector('.flex-1 + button'); 
            
            if (isTurbo) {
                startBtn.classList.add('shine-turbo');
                fetchBtn.classList.add('shine-turbo'); 
            } else {
                startBtn.classList.remove('shine-turbo');
                fetchBtn.classList.remove('shine-turbo');
            }
        }
        
        // ---------------------------------------------------
        // 3. Stop Process Function (UPDATED for animation)
        // ---------------------------------------------------
        function stopProcess(isComplete = true) {
            const startBtn = document.getElementById('start-btn');
            const stopBtn = document.getElementById('stop-btn');
            const logContainer = document.getElementById('log-container');
            const messageElement = document.getElementById('global-completion-message');

            if (eventSource) {
                eventSource.close();
                eventSource = null;
            }

            // UI Reset
            startBtn.disabled = false;
            startBtn.innerHTML = isComplete 
                ? "‚úÖ FINISHED! Click to Run Again."
                : "üõë STOPPED! Click to Run Again.";
            
            // 1. Reset START button to full width
            startBtn.classList.remove('w-3/4');
            startBtn.classList.add('w-full'); 

            // 2. Hide STOP button (Reverse Animation)
            stopBtn.disabled = true;
            stopBtn.classList.remove('w-1/4', 'opacity-100', 'scale-100');
            stopBtn.classList.add('w-0', 'opacity-0', 'scale-0');

            // Set speed back to DEFAULT
            setBackgroundSpeed('speed-default');
            setShineSpeed(false); 

            // Log and Summary Update
            if (!isComplete) {
                logContainer.innerHTML += "<div class='text-red-500 font-bold'>[INTERRUPT] Process manually stopped by user.</div>";
            }
            
            const message = isComplete 
                ? `üèÅ Session Complete! Success: ${totalSuccessCounter}, Errors: ${totalErrorsCounter}.`
                : `üõë Session Stopped! Success: ${totalSuccessCounter}, Errors: ${totalErrorsCounter}.`;
            messageElement.innerText = message;
            messageElement.classList.remove('hidden');

            // Save history only if consent is given
            if (consentStatus === 'accept') {
                logUsage(isComplete ? 'FINISHED' : 'STOPPED');
            }
        }


        // ---------------------------------------------------
        // 2. Start Process and SSE Log Streaming (UPDATED for animation)
        // ---------------------------------------------------
        function startProcess() {
            const startBtn = document.getElementById('start-btn');
            const stopBtn = document.getElementById('stop-btn');
            const logContainer = document.getElementById('log-container');
            const MAX_LOGS = 100; 
            
            const entries = {};
            document.querySelectorAll('#entry-list > div').forEach(entryDiv => {
                const idInput = entryDiv.querySelector('.entry-id-input');
                const valueInput = entryDiv.querySelector('.entry-value-input');
                
                const entryId = idInput.value.trim();
                const entryValue = valueInput.value.trim();
                
                if (entryId && entryValue) {
                    entries[entryId] = entryValue;
                }
            });

            if (!document.getElementById('url').value || Object.keys(entries).length === 0) {
                logContainer.innerHTML += "<div class='text-red-500'>[ERROR] Please provide URL and at least one valid entry field.</div>";
                return;
            }
            
            // Check Consent - Prevent tracking if rejected
            if (consentStatus !== 'accept') {
                logContainer.innerHTML += "<div class='text-orange-400'>[WARNING] Usage history logging disabled (Cookie rejected).</div>";
            }

            const params = new URLSearchParams({
                url: document.getElementById('url').value,
                total: document.getElementById('total').value,
                bots: document.getElementById('bots').value,
                delay: document.getElementById('delay').value,
                mode: document.getElementById('mode').value,
                pages: document.getElementById('pages').value, 
                entries: JSON.stringify(entries)
            });

            // --- Reset all counters ---
            totalSuccessCounter = 0;
            totalErrorsCounter = 0;
            totalAttemptsCounter = 0;
            document.getElementById('global-attempt-counter').innerText = '0';
            document.getElementById('global-success-counter').innerText = '0';
            document.getElementById('global-error-counter').innerText = '0';
            document.getElementById('global-completion-message').classList.add('hidden');
            // --- END Reset ---

            // Set speed to TURBO when starting
            setBackgroundSpeed('speed-turbo');
            setShineSpeed(true); 

            logContainer.innerHTML = "<div class='text-blue-400 flex items-center'>[SYSTEM] <svg class='animate-spin ml-2 h-3 w-3 text-blue-400' xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24'><circle class='opacity-25' cx='12' cy='12' r='10' stroke='currentColor' stroke-width='4'></circle><path class='opacity-75' fill='currentColor' d='M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z'></path></svg> Attempting to connect to stream... (Simulated)</div>";
            
            // --- NEW: Handle Start/Stop Button UI with animation ---
            startBtn.disabled = true;
            startBtn.innerHTML = "<span class='flex items-center justify-center'><svg class='animate-spin h-5 w-5 mr-3 text-white' xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24'><circle class='opacity-25' cx='12' cy='12' r='10' stroke='currentColor' stroke-width='4'></circle><path class='opacity-75' fill='currentColor' d='M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z'></path></svg>RUNNING...</span>";
            
            // 1. Resize START button (w-full -> w-3/4)
            startBtn.classList.remove('w-full'); 
            startBtn.classList.add('w-3/4'); 
            
            // 2. Show STOP button (w-0 -> w-1/4, opacity/scale 0 -> 100)
            stopBtn.disabled = false;
            stopBtn.classList.remove('w-0', 'opacity-0', 'scale-0'); 
            stopBtn.classList.add('w-1/4', 'opacity-100', 'scale-100'); 
            // --- END NEW UI ---
            
            eventSource = new EventSource(`/api/stream?${params.toString()}`); // ASSIGN TO GLOBAL

            eventSource.onmessage = function(event) {
                const newLog = document.createElement('div');
                newLog.className = "mb-1 whitespace-pre-wrap transition-opacity duration-300"; 
                
                let isFinished = false;

                // --- UPDATED: Counter Logic ---
                if (event.data.includes('‚úÖ SUCCESS')) {
                    newLog.classList.add('text-green-400');
                    
                    // Increment and update UI
                    totalSuccessCounter++;
                    totalAttemptsCounter++;
                    document.getElementById('global-success-counter').innerText = totalSuccessCounter;
                    document.getElementById('global-attempt-counter').innerText = totalAttemptsCounter;
                    
                } else if (event.data.includes('‚ùå FAIL') || event.data.includes('‚ö†Ô∏è ERROR')) {
                    newLog.classList.add(event.data.includes('‚ùå FAIL') ? 'text-red-400' : 'text-orange-400');
                    
                    // Increment and update UI
                    totalErrorsCounter++;
                    totalAttemptsCounter++;
                    document.getElementById('global-error-counter').innerText = totalErrorsCounter;
                    document.getElementById('global-attempt-counter').innerText = totalAttemptsCounter;

                } else if (event.data.includes('üèÅ FINISHED')) {
                    isFinished = true;
                    newLog.classList.add('text-yellow-400', 'font-bold', 'mt-2');
                } else {
                    newLog.classList.add('text-slate-300');
                }
                // --- END UPDATED Counter Logic ---

                newLog.innerText = `> ${event.data}`;
                logContainer.appendChild(newLog);
                
                if (logContainer.children.length > MAX_LOGS) {
                    logContainer.removeChild(logContainer.firstChild);
                }

                logContainer.scrollTop = logContainer.scrollHeight; 

                if (isFinished) {
                    stopProcess(true); // Use unified stop function
                }
            };

            eventSource.onerror = function(err) {
                stopProcess(false); // Use unified stop function for error
            };
        }

        function clearLog() { document.getElementById('log-container').innerHTML = ""; }
        
        // ---------------------------------------------------
        // 4. Cookie Consent & History Functions (UPDATED for animation and style)
        // ---------------------------------------------------
        function checkCookieConsent() {
            const banner = document.getElementById('cookie-banner');
            consentStatus = localStorage.getItem('cookieConsent');
            
            if (consentStatus === null) {
                // Show banner by removing the class that hides it (translate-y-full)
                banner.classList.remove('translate-y-full');
            } else if (consentStatus === 'reject') {
                // If rejected, log a warning
                const logContainer = document.getElementById('log-container');
                if (logContainer) {
                    logContainer.innerHTML += "<div class='text-orange-400'>[INFO] Usage history logging is currently disabled.</div>";
                }
            }
        }

        function setCookieConsent(status) {
            consentStatus = status;
            localStorage.setItem('cookieConsent', status);
            // Hide banner by adding the class that slides it out
            document.getElementById('cookie-banner').classList.add('translate-y-full'); 
            
            if (status === 'reject') {
                // Clear existing history upon rejection
                localStorage.removeItem(HISTORY_KEY);
            }
        }
        
        function logUsage(status) {
            if (consentStatus !== 'accept') return; // Only log if accepted

            const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
            const newEntry = {
                timestamp: new Date().toISOString(),
                url: document.getElementById('url').value.substring(0, 50) + '...',
                total: parseInt(document.getElementById('total').value),
                success: totalSuccessCounter,
                errors: totalErrorsCounter,
                status: status
            };
            
            history.unshift(newEntry); // Add to the beginning
            // Keep history list manageable (max 20 entries)
            if (history.length > 20) {
                history.pop(); 
            }
            
            localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
        }

        function clearHistory() {
            localStorage.removeItem(HISTORY_KEY);
            displayHistory(); // Refresh modal view
        }

        function displayHistory() {
            const historyList = document.getElementById('history-list');
            const history = JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
            
            if (history.length === 0) {
                historyList.innerHTML = '<p class="text-slate-500 text-sm text-center p-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>';
                return;
            }

            historyList.innerHTML = history.map(entry => {
                // Use Thai locale for date formatting
                const date = new Date(entry.timestamp).toLocaleString('th-TH', { 
                    year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' 
                });
                
                let statusText, statusBgClass, statusIcon;
                if (entry.status === 'FINISHED') {
                    statusText = '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô';
                    statusBgClass = 'bg-green-600';
                    statusIcon = '‚úÖ';
                } else {
                    statusText = '‡∏´‡∏¢‡∏∏‡∏î‡πÇ‡∏î‡∏¢‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ';
                    statusBgClass = 'bg-red-600';
                    statusIcon = 'üõë';
                }
                
                return `
                    <div class="bg-slate-700 p-3 rounded-lg border border-slate-600 hover:border-indigo-500 transition-colors duration-200">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs font-bold text-slate-200 flex items-center">
                                ${statusIcon} 
                                <span class="ml-1 ${statusBgClass} text-white px-2 py-0.5 rounded-full text-[10px] shadow-md">${statusText}</span>
                            </span>
                            <span class="text-[10px] text-slate-400">${date}</span>
                        </div>
                        <p class="text-xs text-slate-400 truncate font-mono">URL: ${entry.url}</p>
                        <div class="flex justify-start text-xs mt-2 space-x-4 pt-1 border-t border-slate-600">
                            <span class="text-indigo-300 font-bold">‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°: <span class="text-base">${entry.total}</span></span>
                            <span class="text-green-300 font-bold">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: <span class="text-base">${entry.success}</span></span>
                            <span class="text-red-300 font-bold">‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: <span class="text-base">${entry.errors}</span></span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showHistoryModal() {
            if (consentStatus !== 'accept') {
                alert("‡πÇ‡∏õ‡∏£‡∏î‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏Å‡∏Å‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
                return;
            }
            
            displayHistory();
            const modal = document.getElementById('history-modal');
            const content = document.getElementById('history-modal-content');

            // Show modal container
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // Apply enter animation
            content.classList.remove('modal-exit', 'modal-exit-active', 'modal-enter');
            content.classList.add('modal-enter');
            requestAnimationFrame(() => content.classList.add('modal-enter-active'));
        }

        function hideHistoryModal() {
            const modal = document.getElementById('history-modal');
            const content = document.getElementById('history-modal-content');

            // Apply exit animation
            content.classList.remove('modal-enter', 'modal-enter-active', 'modal-exit');
            content.classList.add('modal-exit');
            requestAnimationFrame(() => content.classList.add('modal-exit-active'));

            // Hide modal container after animation
            setTimeout(() => {
                modal.classList.remove('flex');
                modal.classList.add('hidden');
            }, 300); // 300ms matches the transition duration
        }

        // ---------------------------------------------------
        // 5. Ping Function (Unchanged)
        // ---------------------------------------------------
        function checkPing() {
            const start = performance.now();
            fetch('/') 
                .then(response => {
                    const duration = Math.round(performance.now() - start);
                    const pingStatus = document.getElementById('ping-status');
                    const pingDot = document.getElementById('ping-dot');

                    pingStatus.innerText = `${duration} ms`;
                    
                    pingDot.classList.remove('ping-yellow', 'ping-red', 'ping-green');
                    if (duration < 150) {
                        pingDot.classList.add('ping-green');
                    } else if (duration < 500) {
                        pingDot.classList.add('ping-yellow');
                    } else {
                        pingDot.classList.add('ping-red');
                    }
                })
                .catch(() => {
                    document.getElementById('ping-status').innerText = 'Offline';
                    document.getElementById('ping-dot').classList.remove('ping-yellow', 'ping-green');
                    document.getElementById('ping-dot').classList.add('ping-red');
                });
        }
        
        // ---------------------------------------------------
        // 6. Lanyard Discord Status (Unchanged)
        // ---------------------------------------------------
        function connectLanyard() {
            const userId = "902739412172046427"; 
            const ws = new WebSocket("wss://api.lanyard.rest/socket");

            ws.onopen = () => {
                ws.send(JSON.stringify({
                    op: 2,
                    d: { subscribe_to_ids: [userId] }
                }));
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.op === 1 && data.d) {
                    setInterval(() => {
                        ws.send(JSON.stringify({ op: 3 }));
                    }, data.d.heartbeat_interval);
                }

                if (data.t === "PRESENCE_UPDATE" || data.t === "INIT_STATE") {
                    updateDiscordStatus(data.d);
                }
            };

            ws.onerror = (error) => {
                console.error("Lanyard WS Error:", error);
                document.getElementById('discord-state-text').innerText = 'Connection Error';
                document.getElementById('discord-status-dot').className = 'status-dot status-offline';
                setTimeout(connectLanyard, 5000); 
            };
        }

        function getAssetUrl(activity, assetKey) {
            if (!assetKey) return null;

            if (assetKey.startsWith('spotify:')) {
                return `https://i.scdn.co/image/${assetKey.split(':')[1]}`;
            }
            if (assetKey.startsWith('mp:')) {
                const activityId = activity.application_id;
                return `https://cdn.discordapp.com/app-assets/${activityId}/${assetKey}.png`;
            }
            
            return null;
        }

        function updateDiscordStatus(d) {
            const usernameElement = document.getElementById('discord-username');
            const stateTextElement = document.getElementById('discord-state-text');
            const statusDotElement = document.getElementById('discord-status-dot');
            const avatarElement = document.getElementById('discord-avatar');
            const activityContainer = document.getElementById('discord-activity');
            const activityNameElement = document.getElementById('discord-activity-name');
            const activityDetailsElement = document.getElementById('discord-activity-details');
            const activityImageElement = document.getElementById('activity-large-image');


            const status = d.discord_status || 'offline';
            let statusText = 'Offline';
            let statusClass = 'status-offline';
            let avatarUrl = 'https://cdn.discordapp.com/embed/avatars/0.png';

            // 1. Update Username and Avatar
            if (d.discord_user) {
                const user = d.discord_user;
                const discriminator = user.discriminator === '0' ? '' : `#${user.discriminator}`;
                usernameElement.innerText = `${user.username}${discriminator}`;
                
                avatarUrl = user.avatar 
                    ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=128`
                    : `https://cdn.discordapp.com/embed/avatars/${(user.discriminator === '0' ? parseInt(user.id) >> 22 : parseInt(user.discriminator)) % 5}.png`;
            } else {
                usernameElement.innerText = '902739412172046427 (Loading)';
            }
            avatarElement.src = avatarUrl;
            
            // 2. Update Main Status
            switch (status) {
                case 'online':
                    statusText = 'Online';
                    statusClass = 'status-online';
                    break;
                case 'idle':
                    statusText = 'Idle (AFK)';
                    statusClass = 'status-idle';
                    break;
                case 'dnd':
                    statusText = 'Do Not Disturb';
                    statusClass = 'status-dnd';
                    break;
                default:
                    statusText = 'Offline';
                    statusClass = 'status-offline';
                    break;
            }

            stateTextElement.innerText = statusText;
            statusDotElement.className = `status-dot ${statusClass}`;
            stateTextElement.classList.remove('text-yellow-400', 'text-green-400', 'text-red-400');
            stateTextElement.classList.add(status === 'online' ? 'text-green-400' : 'text-yellow-400');
            
            // 3. Update Activity (Playing/Listening)
            activityContainer.classList.add('hidden');
            activityImageElement.classList.add('hidden');
            activityImageElement.src = '';
            activityNameElement.innerText = '';
            activityDetailsElement.innerText = '';

            const mainActivity = d.activities 
                ? d.activities.find(a => a.type === 0 || a.type === 2) 
                : null;
            
            if (mainActivity) {
                let activityName = '';
                let activityDetails = '';

                // A. ‡∏î‡∏∂‡∏á Large Image
                if (mainActivity.assets && mainActivity.assets.large_image) {
                    const largeImageUrl = getAssetUrl(mainActivity, mainActivity.assets.large_image);
                    if (largeImageUrl) {
                        activityImageElement.src = largeImageUrl;
                        activityImageElement.classList.remove('hidden');
                    }
                }

                // B. ‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Text
                if (mainActivity.type === 0) { // Playing
                    activityName = `üéÆ Playing ${mainActivity.name}`;
                    activityDetails = mainActivity.details || mainActivity.state || '';
                } else if (mainActivity.type === 2) { // Listening (Spotify)
                    activityName = `üéß Listening to ${mainActivity.details}`; // Song Title
                    activityDetails = `by ${mainActivity.state}`; // Artist
                }

                if (activityName) {
                    activityNameElement.innerText = activityName;
                    activityDetailsElement.innerText = activityDetails;
                    activityContainer.classList.remove('hidden');
                }
            }
        }


        // ---------------------------------------------------
        // 7. Background Emoji Logic (Unchanged)
        // ---------------------------------------------------
        const EMOJIS = ['üöÄ', '‚ú®', 'üíª', 'üí°', 'ü§ñ', 'üî•', '‚≠êÔ∏è', '‚ö°Ô∏è', '‚úÖ', 'üìà', 'üîí', 'üåê', 'üì°', '‚öôÔ∏è', 'üíé', 'üîë', 'üìä'];
        const NUM_EMOJIS = 80; 
        
        function initEmojiBackground() {
            const container = document.getElementById('emoji-bg-container');

            for (let i = 0; i < NUM_EMOJIS; i++) {
                const emoji = document.createElement('div');
                emoji.className = 'emoji-item';
                emoji.innerText = EMOJIS[Math.floor(Math.random() * EMOJIS.length)];

                // ‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤) 
                emoji.style.left = `${Math.random() * 100}%`; 
                // ‡∏™‡∏∏‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î (‡πÄ‡∏•‡πá‡∏Å 20px - ‡πÉ‡∏´‡∏ç‡πà 50px)
                emoji.style.fontSize = `${Math.floor(Math.random() * 30) + 20}px`; 
                // ‡∏™‡∏∏‡πà‡∏°‡∏î‡∏µ‡πÄ‡∏•‡∏¢‡πå (‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô) - ‡πÉ‡∏ä‡πâ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏≤‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏•‡∏≠‡∏¢‡∏î‡∏π‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á
                emoji.style.animationDelay = `-${Math.random() * 25}s`; 
                
                container.appendChild(emoji);
            }
        }
        
        // ---------------------------------------------------
        // 8. Intro Animation Logic (Unchanged)
        // ---------------------------------------------------
        function hideSplashScreen() {
            const splashScreen = document.getElementById('splash-screen');
            const mainContent = document.getElementById('main-content');
            
            // ‡πÉ‡∏´‡πâ‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡∏£‡∏±‡∏ô‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2.5-3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                splashScreen.style.opacity = '0';
                mainContent.style.opacity = '1'; 
                
                // ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å fade out ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô/‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å DOM
                setTimeout(() => {
                    splashScreen.style.visibility = 'hidden';
                    splashScreen.style.display = 'none'; 
                }, 1000); // 1s matches the transition duration
            }, 2500); // Wait 2.5 seconds before starting fade out
        }


        // --- Run Initial Functions on Load ---
        document.addEventListener('DOMContentLoaded', () => {
             // 1. Initialise Emoji Background
             initEmojiBackground();
             
             // 2. Hide Splash Screen and show content
             hideSplashScreen(); 

             // 3. Ping check
             setInterval(checkPing, 5000);
             checkPing();
             
             // 4. Lanyard Connection
             connectLanyard();

             // 5. NEW: Check Cookie Consent
             checkCookieConsent();
        });

        const messages = [
          "‚öîÔ∏è WIAYOUHI",
          "‚ú® My name is Wia",
          "üî• I AM THANAWAT",
          "üí• WEB BY THANAWAT.WIA",
          "üß¨ IG: Thanawat.wia"
        ];
        
        const effects = ["typing", "glitch", "scroll", "wave"];
        let currentMessage = 0;
        let interval;
        let animationInProgress = false;
        
        function startRandomEffect() {
          if (animationInProgress) return;
          animationInProgress = true;
        
          const effect = effects[Math.floor(Math.random() * effects.length)];
          const message = messages[currentMessage];
          currentMessage = (currentMessage + 1) % messages.length;
        
          if (effect === "typing") return typingEffect(message);
          if (effect === "glitch") return glitchEffect(message);
          if (effect === "scroll") return scrollEffect(message);
          if (effect === "wave") return waveEffect(message);
        }
        
        // Typing Effect
        function typingEffect(text) {
          let i = 0;
          const step = () => {
            document.title = text.substring(0, i) + "_";
            i++;
            if (i <= text.length) {
              setTimeout(step, 60);
            } else {
              setTimeout(() => {
                animationInProgress = false;
                startRandomEffect();
              }, 1500);
            }
          };
          step();
        }
        
        // Glitch Effect
        function glitchEffect(text) {
          const glitchChars = "!@#$%^&*()_+=<>?/|\\~";
          let count = 0;
          const max = 15;
          const glitch = () => {
            const glitched = text
              .split("")
              .map((c) => (Math.random() < 0.25 ? glitchChars[Math.floor(Math.random() * glitchChars.length)] : c))
              .join("");
            document.title = glitched;
            count++;
            if (count < max) {
              setTimeout(glitch, 70);
            } else {
              document.title = text;
              setTimeout(() => {
                animationInProgress = false;
                startRandomEffect();
              }, 1500);
            }
          };
          glitch();
        }
        
        // Scroll Effect
        // Scroll Effect
function scrollEffect(text) {
  let msg = "   " + text + "   ";
  let i = 0;
  let scrollCycles = 0;
  const maxCycles = 3; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£

  const scroll = () => {
    document.title = msg.substring(i) + msg.substring(0, i);
    i = (i + 1) % msg.length;

    if (i === 0) scrollCycles++; // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏ô‡∏à‡∏ö 1 ‡∏£‡∏≠‡∏ö

    if (scrollCycles < maxCycles) {
      setTimeout(scroll, 120);
    } else {
      setTimeout(() => {
        animationInProgress = false;
        startRandomEffect();
      }, 1000);
    }
  };
  scroll();
}

        
        // Wave Effect
        function waveEffect(text) {
          let index = 0;
          const wave = () => {
            let result = "";
            for (let i = 0; i < text.length; i++) {
              result += i === index ? text[i].toUpperCase() : text[i];
            }
            document.title = result;
            index++;
            if (index < text.length) {
              setTimeout(wave, 100);
            } else {
              setTimeout(() => {
                animationInProgress = false;
                startRandomEffect();
              }, 1200);
            }
          };
          wave();
        }
        
        startRandomEffect();
    </script>
</body>
</html>